<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gerenciador de Mapas - Last Take Manager</title>
<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700;900&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static', filename='css/map_manager_enhanced.css') }}">
<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>

<input type="hidden" id="sessionId" value="{{ session_id }}">

<!-- Header -->
<header class="header">
    <div class="header-left">
        <button class="back-btn" onclick="window.location.href='/dashboard'">â† Voltar</button>
        <h1>ğŸ—ºï¸ Gerenciador de Mapas AvanÃ§ado</h1>
    </div>
    <div class="header-actions">
        <button class="btn btn-danger" onclick="clearAll()">ğŸ—‘ï¸ Limpar Tudo</button>
        <button class="btn" onclick="clearDrawings()">ğŸ§¹ Limpar Desenhos</button>
    </div>
</header>

<div class="main-layout">
    <!-- Sidebar Esquerda - Ferramentas -->
    <aside class="sidebar left-sidebar">
        <div class="section">
            <h3>ğŸ› ï¸ Ferramentas</h3>
            <div class="tool-selector">
                <button class="tool-btn active" onclick="setTool('select')">âœ‹ Selecionar</button>
                <button class="tool-btn" onclick="setTool('pan')">ğŸ¤š Mover Canvas</button>
                <button class="tool-btn" onclick="setTool('draw')">âœï¸ Desenhar</button>
                <button class="tool-btn" onclick="setTool('erase')">ğŸ§¹ Apagar</button>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ¨ ConfiguraÃ§Ãµes de Desenho</h3>
            <div class="drawing-controls">
                <div class="control-group">
                    <label>Tamanho do Pincel</label>
                    <input type="range" id="brushSize" min="1" max="20" value="3" onchange="setBrushSize(this.value)">
                </div>
                
                <div class="control-group">
                    <label>Cor</label>
                    <div class="color-palette">
                        <div class="color-option active" style="background: #9b59b6;" onclick="setDrawingColor('#9b59b6')"></div>
                        <div class="color-option" style="background: #e74c3c;" onclick="setDrawingColor('#e74c3c')"></div>
                        <div class="color-option" style="background: #3498db;" onclick="setDrawingColor('#3498db')"></div>
                        <div class="color-option" style="background: #2ecc71;" onclick="setDrawingColor('#2ecc71')"></div>
                        <div class="color-option" style="background: #f39c12;" onclick="setDrawingColor('#f39c12')"></div>
                        <div class="color-option" style="background: #1abc9c;" onclick="setDrawingColor('#1abc9c')"></div>
                        <div class="color-option" style="background: #e67e22;" onclick="setDrawingColor('#e67e22')"></div>
                        <div class="color-option" style="background: #ecf0f1;" onclick="setDrawingColor('#ecf0f1')"></div>
                        <div class="color-option" style="background: #34495e;" onclick="setDrawingColor('#34495e')"></div>
                        <div class="color-option" style="background: #000000;" onclick="setDrawingColor('#000000')"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="section">
            <h3>ğŸ—ºï¸ Adicionar Elementos</h3>
            <button class="btn btn-primary" onclick="addMap()">ğŸ“ Adicionar Mapa</button>
            <button class="btn btn-primary" onclick="addEntity()">ğŸ–¼ï¸ Adicionar Entidade (PNG)</button>
            <button class="btn btn-primary" onclick="addToken()">ğŸ­ Adicionar Token</button>
        </div>

        <div class="section">
            <h3>ğŸ­ Tokens</h3>
            <div class="token-list" id="tokenList"></div>
        </div>

        <div class="section">
            <h3>ğŸ”— Compartilhar</h3>
            <button class="btn btn-success" style="width: 100%;" onclick="copyShareLink()">
                ğŸ“‹ Copiar Link para Jogadores
            </button>
            <p style="color: #888; font-size: 0.8rem; margin-top: 8px; text-align: center;">
                Jogadores podem entrar e vocÃª controla suas permissÃµes
            </p>
        </div>
    </aside>

    <!-- Canvas Central -->
    <div class="canvas-container">
        <canvas id="mapCanvas"></canvas>
        <canvas id="drawingCanvas"></canvas>
        
        <div class="zoom-controls">
            <button class="zoom-btn" onclick="zoom(-0.1)">âˆ’</button>
            <button class="zoom-btn" onclick="zoom(0.1)">+</button>
        </div>
        
        <div class="help-box">
            <strong>ğŸ’¡ Dica:</strong> Use "Mover Canvas" para navegar pelo mapa grande
        </div>
    </div>

    <!-- Sidebar Direita - Jogadores -->
    <aside class="sidebar right-sidebar">
        <div class="section">
            <h3>ğŸ‘¥ Jogadores Online</h3>
            <div class="players-list" id="playersList">
                <div class="empty-players">Nenhum jogador conectado</div>
            </div>
        </div>
    </aside>
</div>

<!-- Modal de Token -->
<div class="modal" id="tokenModal">
    <div class="modal-content">
        <h3>Adicionar Token</h3>
        
        <div class="control-group">
            <label>Nome</label>
            <input type="text" id="tokenName" placeholder="Ex: Guerreiro">
        </div>
        
        <div class="control-group">
            <label>Imagem (opcional)</label>
            <input type="file" id="tokenImage" accept="image/*">
        </div>
        
        <div class="modal-actions">
            <button class="btn" onclick="closeTokenModal()">Cancelar</button>
            <button class="btn btn-primary" onclick="createToken()">Criar Token</button>
        </div>
    </div>
</div>

<!-- Modal de PermissÃµes de Tokens -->
<div class="modal" id="tokenPermissionsModal">
    <div class="modal-content large">
        <h3 id="tokenPermModalTitle">PermissÃµes de Tokens</h3>
        <input type="hidden" id="currentPlayerId">
        
        <p style="color: #bbb; margin-bottom: 15px;">
            Selecione quais tokens este jogador pode mover:
        </p>
        
        <div class="token-perm-list" id="tokenPermList"></div>
        
        <div class="modal-actions">
            <button class="btn btn-primary" onclick="closeTokenPermissionsModal()">Fechar</button>
        </div>
    </div>
</div>

<div class="toast" id="toast"></div>

<script defer src="{{ url_for('static', filename='js/map_manager_enhanced.js') }}"></script>

</body>
</html>